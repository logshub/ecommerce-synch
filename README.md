# eCommerce Synch

![Schema](img/ecommerce_synch.png)

This is NOT a plugin to any of eCommerce platform. This is standalone application
that process data from store's database (by modules for specific platform) into
other system eg. LogsHub.com search service.

### Supported eCommerce platforms

* WooCommerce (5.1.1)
* PrestaShop (1.6.1.10 - 1.7.5.1)
* OpenCart (2.1.0.2 - X)
* osCommerce (2.3.4.1 - 2.4.2)
* Sylius (1.4.3)

Other versions might work as well, but was not tested.

### How does it work

Cron executes synchronization command. It takes configuration file, determine what is input module.
It executes its SQL SELECT statements and saves result into CSV files (products and categories).
Output module push CSV data into remote system eg. LogsHub.com search service.

### Requirements

* PHP 7 (PDO, pdo_mysql)
* Composer - https://getcomposer.org/

### Installation (easy)

That way is OK for small and medium stores.
It is easier to setup, but little bit less optimal,
as CSV files will be generated by PHP code insetad of database itself.

1. `composer require logshub/ecommerce-synch`
2. `cp ecommerce-synch/config.example.ini ecommerce-synch/config.ini`
3. Setup your `ecommerce-synch/config.ini`: logshub credentials, input module and database connection. Set `generate_csv_by_database = 0` (easy configuration).
4. Add into your cron: `php bin/ecommerce-search synch -c config.ini` every day in the night.

### Installation (experimental, advanced)

It is more advanced setup, but more optimal,
as CSV files will be generated by database itself insetad of PHP code.

1. Make sure you run this code on the same server with database - access to `/var/lib/mysql-files/` needed.
2. Your DB user must have `FILE` privilege in database (see below).
3. Process with the "easy" installation steps with this exception: `generate_csv_by_database = 1`.

AD 2

```
GRANT FILE ON *.* TO myuser;
FLUSH PRIVILEGES;
```

### How to create cron job?

...

### How to create input module?

...

### Troubleshooting

* last updated time is not calculated correctly: make sure timezone is the same on the PHP and database side

### TODO

* check last_updated fields in databases to make smaller synchronization (already done for prestashop).
* clear old CSV files (new command)
* check visibility in SQLs (opencart, oscommerce)
* callback for database dump

### Input modules to do

* Magento
* ShopWare
* Ubercart - https://www.drupal.org/project/ubercart 
* Spree - https://github.com/spree/spree
